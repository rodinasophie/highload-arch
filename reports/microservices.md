# Микросервисы. Декомпозиция системы.  
Данная домашняя работа была направлена на изучение декомпозиции системы на микросервисы. В рамках данного задания были выполнены следующие пункты:
1. Подсистема диалогов была выделена в отдельный микросервис
2. Подсистема диалогов получила собственную БД(репликация настроена не была в целях упрощения системы)
3. Была реализована подсистема проверки аутентификации и метод `/checkAuth` для проверки подлинности токена для подсистемы диалогов
4. Была поддержана возможность ходить по префиксами `/api/v1` и `/api/v2` для всех методов cистемы
5. Запросы `/api/v1/dialogs/...` перенаправляются в подсистему диалогов
6. Реализовано сквозное логирование

## Подробности реализации
В рамках выполнения данного домашнего задания возник нюанс, связанный с тем, что подсистема диалогов требует проверки подлинности токена пользователя, что не является ответственностью самого микросервиса диалогов. Для проверки подлинности, в идеале, необходимо реализовать отдельный сервис аутентификации и при помощи API Gateway осуществлять проверку каждого запроса через данный сервис и только после этого отправлять его в подсистему диалогов. В текущей реализации подсистема аутентификации осталась частью монолитного ядра, но каждый запрос к подсистеме диалогов осуществляет вызов `/checkAuth` для проверки подлинности токена, в случае неуспешной проверки, запрос возвращает ошибку.

Сборка подсистемы диалогов:
`make docker-dialogs-db && make docker-dialogs && make docker-run-dialogs`

Подсистема диалогов слушает на порте `:8086`.

Также был развернут набор контейнеров `ElasticSearch+Kibana+LogStash+FileBeat` для реализации сквозного логирования. Запуск системы: `make docker-logs`, пароль для просмотра логов `elastic:elastic`. Filebeat развернут в отдельном докер-контейнере, поэтому логи маппируются через папку на хосте развертывания. Данный подход можно улучшить, установив `filebeat` на каждый из хостов сервиса.